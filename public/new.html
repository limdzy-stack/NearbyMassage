<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Nearby Massage in Singapore – Spa Listings & Contact</title>
    <meta
      name="description"
      content="Discover nearby massage spas in Singapore. View address, services, photos, and contact options including call, WhatsApp and map directions."
    />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png" href="/favicon.png" />

    <!-- Basic styling (no framework) -->
    <style>
      body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: linear-gradient(135deg, #e0f7f4, #fefdfb);
        color: #064e3b;
      }
      .page-wrap {
        max-width: 980px;
        margin: 0 auto;
        padding: 16px;
      }
      header {
        padding: 16px 0;
        border-bottom: 1px solid #d1fae5;
      }
      header h1 {
        margin: 0 0 8px;
        font-size: 24px;
        color: #047857;
      }
      header p {
        margin: 0;
        font-size: 14px;
        color: #374151;
      }

      .info-note {
        margin-top: 12px;
        font-size: 13px;
        color: #6b7280;
      }

      .listings-grid {
        margin-top: 24px;
        display: flex;
        flex-direction: column;
        gap: 16px;
      }
      .card {
        background: rgba(255, 255, 255, 0.9);
        border-radius: 16px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.05);
        padding: 12px;
        display: grid;
        grid-template-columns: 120px 1fr;
        gap: 12px;
      }
      @media (max-width: 640px) {
        .card {
          grid-template-columns: 1fr;
        }
      }

      .thumb-strip {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
      }
      .thumb-strip img {
        width: 56px;
        height: 56px;
        object-fit: cover;
        border-radius: 8px;
        border: 1px solid #d1fae5;
        background: #fff;
      }

      .card h2 {
        margin: 0 0 4px;
        font-size: 18px;
        color: #065f46;
      }
      .address {
        font-size: 13px;
        color: #4b5563;
        margin-bottom: 4px;
      }
      .services {
        margin: 4px 0 8px;
        display: flex;
        flex-wrap: wrap;
        gap: 4px;
      }
      .service-pill {
        font-size: 11px;
        padding: 2px 6px;
        border-radius: 999px;
        background: #ecfdf5;
        color: #047857;
      }
      .contact-line {
        font-size: 13px;
        color: #374151;
        margin-bottom: 6px;
      }

      .buttons {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        margin-top: 4px;
      }
      .btn {
        border: none;
        border-radius: 999px;
        padding: 6px 12px;
        font-size: 13px;
        cursor: pointer;
        color: #ffffff;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        justify-content: center;
      }
      .btn-call {
        background: #059669;
      }
      .btn-call:hover {
        background: #047857;
      }
      .btn-whatsapp {
        background: #22c55e;
      }
      .btn-whatsapp:hover {
        background: #16a34a;
      }
      .btn-map {
        background: #3b82f6;
      }
      .btn-map:hover {
        background: #2563eb;
      }
      .btn-website {
        background: #a855f7;
      }
      .btn-website:hover {
        background: #9333ea;
      }

      footer {
        margin-top: 32px;
        padding: 16px 0;
        font-size: 12px;
        color: #6b7280;
        border-top: 1px solid #d1fae5;
      }
    </style>
  </head>

  <body>
    <div class="page-wrap">
      <header>
        <h1>Nearby Massage in Singapore</h1>
        <p>
          Browse approved massage and wellness spas near you. View photos, services, address,
          and contact options. Click call, WhatsApp, or map for quick booking and directions.
        </p>
        <p class="info-note">
          This page shows information provided by the individual spas. Please confirm details directly
          with the shop before visiting.
        </p>
      </header>

      <main>
        <section id="listings">
          <div id="listings-root" class="listings-grid">
            <!-- Listings will be injected here by JavaScript -->
          </div>
        </section>
      </main>

      <footer>
        © <span id="year"></span> Nearby Massage. All rights reserved.
      </footer>
    </div>

    <script>
      // Set footer year
      document.getElementById('year').textContent = new Date().getFullYear();

      // Helper to clean non-digits (for wa.me)
      function digitsOnly(str) {
        return (str || '').replace(/\\D/g, '');
      }

      // Load listings from /listings.json
      fetch('/listings.json')
        .then(function (res) {
          if (!res.ok) throw new Error('Failed to load listings.json');
          return res.json();
        })
        .then(function (data) {
          if (!Array.isArray(data)) return;

          var container = document.getElementById('listings-root');
          container.innerHTML = '';

          // ONLY approved listings
          var approved = data.filter(function (x) { return x.approved; });

          approved.forEach(function (item) {
            var card = document.createElement('article');
            card.className = 'card';

            // Left: thumbnails
            var left = document.createElement('div');
            left.className = 'thumb-strip';

            if (Array.isArray(item.photos)) {
              item.photos.forEach(function (src) {
                var img = document.createElement('img');
                img.src = src;
                img.alt = (item.name || 'Spa') + ' photo';
                left.appendChild(img);
              });
            }

            // Right: content
            var right = document.createElement('div');

            var h2 = document.createElement('h2');
            h2.textContent = item.name || 'Massage Spa';
            right.appendChild(h2);

            if (item.address) {
              var addr = document.createElement('div');
              addr.className = 'address';
              addr.textContent = item.address;
              right.appendChild(addr);
            }

            if (Array.isArray(item.services) && item.services.length > 0) {
              var servicesRow = document.createElement('div');
              servicesRow.className = 'services';
              item.services.forEach(function (s) {
                var pill = document.createElement('span');
                pill.className = 'service-pill';
                pill.textContent = s;
                servicesRow.appendChild(pill);
              });
              right.appendChild(servicesRow);
            }

            if (item.phone || item.whats) {
              var contact = document.createElement('div');
              contact.className = 'contact-line';
              contact.textContent =
                'Contact: ' +
                (item.phone ? item.phone : '') +
                (item.whats && item.whats !== item.phone ? ' | WhatsApp: ' + item.whats : '');
              right.appendChild(contact);
            }

            // Buttons
            var btnRow = document.createElement('div');
            btnRow.className = 'buttons';

            if (item.phone) {
              var callBtn = document.createElement('a');
              callBtn.href = 'tel:' + item.phone;
              callBtn.className = 'btn btn-call';
              callBtn.textContent = 'Call';
              btnRow.appendChild(callBtn);
            }

            if (item.whats) {
              var waBtn = document.createElement('a');
              var msg = encodeURIComponent(
                'Hello, I found your spa on Nearby Massage and would like to know more about your services.'
              );
              waBtn.href = 'https://wa.me/' + digitsOnly(item.whats) + '?text=' + msg;
              waBtn.target = '_blank';
              waBtn.rel = 'noopener noreferrer';
              waBtn.className = 'btn btn-whatsapp';
              waBtn.textContent = 'WhatsApp';
              btnRow.appendChild(waBtn);
            }

            // Show on map (Google Maps using lat/lng if available)
            if (item.loc && typeof item.loc.lat === 'number' && typeof item.loc.lng === 'number') {
              var mapBtn = document.createElement('a');
              mapBtn.href =
                'https://www.google.com/maps?q=' + item.loc.lat + ',' + item.loc.lng;
              mapBtn.target = '_blank';
              mapBtn.rel = 'noopener noreferrer';
              mapBtn.className = 'btn btn-map';
              mapBtn.textContent = 'Show on Map';
              btnRow.appendChild(mapBtn);
            }

            // Visit website (optional: only if listing has website)
            if (item.website) {
              var webBtn = document.createElement('a');
              webBtn.href = item.website;
              webBtn.target = '_blank';
              webBtn.rel = 'noopener noreferrer';
              webBtn.className = 'btn btn-website';
              webBtn.textContent = 'Visit Website';
              btnRow.appendChild(webBtn);
            }

            right.appendChild(btnRow);

            card.appendChild(left);
            card.appendChild(right);

            container.appendChild(card);
          });
        })
        .catch(function (err) {
          console.error('Error loading listings:', err);
          var container = document.getElementById('listings-root');
          container.innerHTML =
            '<p style="color:#b91c1c;font-size:14px;">Unable to load listings at the moment. Please try again later.</p>';
        });
    </script>
  </body>
</html>
