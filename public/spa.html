<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Spa Details</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Spa listing" />
  <meta name="robots" content="index,follow" />

  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #f6f6f6; }
    .wrapper { max-width: 960px; margin: 0 auto; padding: 16px; }
    .card {
      background: #fff; padding: 20px; border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.07);
    }
    h1 { margin-bottom: 8px; font-size: 24px; }
    .subtitle { color: #666; margin-bottom: 18px; }
    .info { margin-bottom: 8px; }
    .label { font-weight: bold; }
    .services li { margin-bottom: 6px; }
    .contact a {
      display: inline-block; margin-right: 10px; margin-top: 6px;
      padding: 8px 12px; border-radius: 6px; border: 1px solid #ddd;
      text-decoration: none; color: #333; font-size: 14px;
    }
    .gallery {
    margin-top: 16px;
    display: grid;
    gap: 10px;
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    }

    .gallery .frame {
    position: relative;
    width: 100%;
    padding-top: calc(16 / 9 * 100%); /* 9 x 16 portrait */
    overflow: hidden;
    border-radius: 10px;
    background: #000;
    }

    .gallery img {
     position: absolute;
     top: 0; left: 0;
     width: 100%;
     height: 100%;
     object-fit: cover;
    }

    .error { text-align: center; padding: 40px; color: #b00020; }
  </style>
</head>

<body>
  <div class="wrapper">
    <div id="content" class="card">
      Loadingâ€¦
    </div>
  </div>

<script>
function getParam(key) {
  const p = new URLSearchParams(window.location.search);
  return p.get(key);
}

function slugify(name) {
  return name.toLowerCase()
    .replace(/[^a-z0-9]+/g, "-")
    .replace(/(^-|-$)+/g, "");
}

async function loadSpa() {
  const content = document.getElementById("content");

  const id = getParam("id");
  const name = getParam("name");
  const slug = getParam("slug");

  const res = await fetch("/listings.json", { cache: "no-store" });
  const data = await res.json();

  let listing = null;

  if (id) {
    listing = data.find(x => x.id === id);
  } else if (name) {
    listing = data.find(x => x.name.toLowerCase() === name.toLowerCase());
  } else if (slug) {
    listing = data.find(x => slugify(x.name) === slug);
  }

  if (!listing) {
    content.innerHTML = `
      <div class="error">
        <h2>Spa Not Found</h2>
        <p>Please check the link again.</p>
      </div>`;
    return;
  }

  if (!listing.approved) {
    content.innerHTML = `
      <div class="error">
        <h2>${listing.name}</h2>
        <p>This listing is not available.</p>
      </div>`;
    return;
  }

  // SEO updates
  document.title = `${listing.name} | Massage in Singapore`;
  const meta = document.querySelector('meta[name="description"]');
  meta.content = listing.services?.[0] || listing.address || listing.name;

  // Format services HTML
  const serviceHTML = listing.services?.length
    ? `<ul class="services">${listing.services.map(s => `<li>${s}</li>`).join("")}</ul>`
    : "";

  // Photos
  const photosHTML = listing.photos?.length
    ? `
      <div class="gallery">
        ${listing.photos.map((src,i) => `
          <img src="${src}" alt="${listing.name} photo ${i+1}" loading="lazy" />
        `).join("")}
      </div>`
    : "";

  // WhatsApp number cleaned
  const wa = listing.whats ? listing.whats.replace(/[^0-9]/g, "") : "";

  content.innerHTML = `
    <h1>${listing.name}</h1>
    <div class="subtitle">${listing.services?.[0] || ""}</div>

    <div class="info"><span class="label">Address:</span> ${listing.address || "N/A"}</div>

    <div class="contact">
      ${listing.phone ? `<a href="tel:${listing.phone}">Call ${listing.phone}</a>` : ""}
      ${wa ? `<a href="https://wa.me/${wa}" target="_blank">WhatsApp</a>` : ""}
      ${listing.website ? `<a href="${listing.website}" target="_blank">Visit Website</a>` : ""}
    </div>

    <h3>Services</h3>
    ${serviceHTML}

    <h3>Photos</h3>
    ${photosHTML}
  `;
}

loadSpa();
</script>

</body>
</html>
